---
phase: 01-foundation
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - _archive/src/
  - _archive/docs/
  - _archive/babel.config.js
  - _archive/yarn.lock
  - _archive/public/
  - package.json
  - src/app/layout.tsx
  - src/app/page.tsx
  - src/app/loading.tsx
  - src/app/error.tsx
  - src/app/globals.css
  - src/lib/utils.ts
  - src/components/ui/button.tsx
  - .env.local
  - .gitignore
  - tsconfig.json
  - next.config.ts
  - tailwind.config.ts
autonomous: true
requirements:
  - INFR-01
  - INFR-02

must_haves:
  truths:
    - "Running `npm run dev` starts the Next.js 16 dev server without errors"
    - "Running `npm run build` succeeds without TDX credentials set in env"
    - "The root page renders in the browser with no JavaScript console errors"
    - "No Vue 2 files exist in the project root — they are in `_archive/`"
    - "`git log` shows a commit archiving old Vue 2 files before Next.js scaffold"
  artifacts:
    - path: "src/app/layout.tsx"
      provides: "Root layout with QueryClientProvider wrapper"
      exports: ["default"]
    - path: "src/app/page.tsx"
      provides: "Home page Server Component (placeholder for Phase 2)"
      exports: ["default"]
    - path: "src/app/error.tsx"
      provides: "Error boundary with 'use client' directive"
      exports: ["default"]
    - path: "src/lib/utils.ts"
      provides: "cn() helper from shadcn/ui init"
      exports: ["cn"]
    - path: "_archive/src/"
      provides: "Preserved Vue 2 source files for reference"
  key_links:
    - from: "src/app/layout.tsx"
      to: "@tanstack/react-query"
      via: "QueryClientProvider import"
      pattern: "QueryClientProvider"
    - from: "src/app/error.tsx"
      to: "'use client'"
      via: "first line directive"
      pattern: "'use client'"
---

<objective>
Migrate the existing Vue 2 repository to a Next.js 16 App Router project in-place. The Vue 2 source is archived (not deleted), then `create-next-app` scaffolds the new project at the repo root.

Purpose: Establish the clean Next.js 16 project structure that all subsequent plans depend on. Without this plan, there is no `src/app/`, no `tsconfig.json`, no `package.json` with Next.js.

Output: A working Next.js 16 project that starts with `npm run dev`, builds with `npm run build` (using mock data — no TDX credentials required), and has shadcn/ui + @tanstack/react-query installed.
</objective>

<execution_context>
@/Users/diamond.hung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/diamond.hung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Archive Vue 2 files and scaffold Next.js 16 project</name>
  <files>
    _archive/src/
    _archive/docs/
    _archive/babel.config.js
    _archive/yarn.lock
    _archive/public/
    package.json
    tsconfig.json
    next.config.ts
    .gitignore
  </files>
  <action>
    Step 1 — Archive existing Vue 2 files (preserving git history via `git mv`):
    ```
    mkdir -p _archive
    git mv src _archive/src
    git mv docs _archive/docs
    git mv babel.config.js _archive/babel.config.js
    git mv yarn.lock _archive/yarn.lock
    git mv public _archive/public
    ```
    If any of these files do not exist, skip that specific `git mv` silently (check with `ls` first).

    Step 2 — Remove the old `package.json` (create-next-app will generate a new one):
    ```
    rm package.json
    ```

    Step 3 — Scaffold Next.js 16 with all required flags:
    ```
    npx create-next-app@latest . \
      --typescript \
      --tailwind \
      --eslint \
      --app \
      --src-dir \
      --import-alias "@/*" \
      --yes
    ```
    When prompted about existing files (README.md, .gitignore), accept overwrite for `.gitignore`. Keep existing README.md.

    Step 4 — Install additional dependencies:
    ```
    npm install server-only @tanstack/react-query zod
    ```

    Step 5 — Initialize shadcn/ui (non-interactive, use New York style + neutral base):
    ```
    npx shadcn@latest init --yes --defaults
    ```
    If `--defaults` flag not accepted, run interactively: choose "New York" style, "neutral" base color, yes to CSS variables.

    Step 6 — Add shadcn/ui Button component (proves shadcn works, used in health check):
    ```
    npx shadcn@latest add button --yes
    ```

    Step 7 — Verify `.gitignore` contains `.env.local`. If not, add it:
    ```
    grep -q ".env.local" .gitignore || echo ".env.local" >> .gitignore
    ```

    Step 8 — Create `.env.local` with placeholder values (not committed):
    Create file `.env.local` with content:
    ```
    # TDX API credentials — obtain from https://tdx.transportdata.tw
    # Leave blank to use mock data during development
    TDX_CLIENT_ID=
    TDX_CLIENT_SECRET=
    ```

    Step 9 — In `package.json` scripts, verify `lint` uses `eslint .` not `next lint` (Next.js 16 removed `next lint`). If the scaffold generated `"lint": "next lint"`, replace with `"lint": "eslint ."`.
  </action>
  <verify>
    Run: `npm run build`
    Expected: Build completes successfully. Output includes "✓ Compiled" or "Route (app)". No errors.

    Run: `npm run dev` (then Ctrl+C after seeing "ready")
    Expected: "Ready in Xms" or "▲ Next.js 16.x.x" appears.

    Run: `ls _archive/`
    Expected: `src/` directory visible (Vue 2 source archived).

    Run: `cat .gitignore | grep env.local`
    Expected: `.env.local` line present.
  </verify>
  <done>
    `npm run build` completes without error with empty TDX env vars. Next.js 16 project is scaffolded at repo root. Vue 2 `src/` is in `_archive/src/`. `.env.local` exists but is not tracked by git.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure root layout with QueryClientProvider and error boundary</name>
  <files>
    src/app/layout.tsx
    src/app/page.tsx
    src/app/loading.tsx
    src/app/error.tsx
    src/app/globals.css
  </files>
  <action>
    Replace the generated `src/app/layout.tsx` with a version that wraps the app in `QueryClientProvider` (required for Phase 2 client-side queries). The provider must be extracted to a `'use client'` component since `QueryClientProvider` is a Client Component:

    Create `src/app/providers.tsx`:
    ```typescript
    'use client'

    import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
    import { useState } from 'react'

    export function Providers({ children }: { children: React.ReactNode }) {
      const [queryClient] = useState(() => new QueryClient())
      return (
        <QueryClientProvider client={queryClient}>
          {children}
        </QueryClientProvider>
      )
    }
    ```

    Update `src/app/layout.tsx` to use Providers:
    ```typescript
    import type { Metadata } from 'next'
    import { Providers } from './providers'
    import './globals.css'

    export const metadata: Metadata = {
      title: '高鐵查詢',
      description: '快速查詢台灣高鐵時刻表與座位狀況',
    }

    export default function RootLayout({
      children,
    }: {
      children: React.ReactNode
    }) {
      return (
        <html lang="zh-TW">
          <body>
            <Providers>{children}</Providers>
          </body>
        </html>
      )
    }
    ```

    Replace `src/app/page.tsx` with a simple placeholder Server Component that confirms the stack is working:
    ```typescript
    export default function HomePage() {
      return (
        <main className="flex min-h-screen flex-col items-center justify-center p-8">
          <h1 className="text-3xl font-bold mb-4">高鐵查詢</h1>
          <p className="text-muted-foreground">查詢功能建置中 — Phase 2</p>
        </main>
      )
    }
    ```

    Create `src/app/loading.tsx` (root loading skeleton):
    ```typescript
    export default function Loading() {
      return (
        <div className="flex min-h-screen items-center justify-center">
          <p className="text-muted-foreground">載入中…</p>
        </div>
      )
    }
    ```

    Create `src/app/error.tsx` (error boundary — MUST have 'use client' as first line):
    ```typescript
    'use client'

    export default function Error({
      error,
      reset,
    }: {
      error: Error & { digest?: string }
      reset: () => void
    }) {
      return (
        <div className="flex min-h-screen flex-col items-center justify-center gap-4">
          <h2 className="text-xl font-semibold">發生錯誤</h2>
          <p className="text-muted-foreground">{error.message}</p>
          <button
            onClick={reset}
            className="rounded bg-primary px-4 py-2 text-primary-foreground"
          >
            重試
          </button>
        </div>
      )
    }
    ```

    Do NOT add animations or complex styling — keep it minimal for Phase 1.
  </action>
  <verify>
    Run: `npm run build`
    Expected: Builds without TypeScript errors. No "use client" boundary violations.

    Run: `npm run dev` and visit http://localhost:3000
    Expected: Page loads with "高鐵查詢" heading. No console errors.

    Run: `cat src/app/error.tsx | head -1`
    Expected: `'use client'` is the first line.
  </verify>
  <done>
    Root layout wraps children in QueryClientProvider (via Providers component). error.tsx has 'use client' as first line. `npm run build` succeeds. Home page renders in browser.
  </done>
</task>

</tasks>

<verification>
Overall Phase 1 Plan 01 checks:

1. `ls _archive/src/` — Vue 2 source files exist in archive
2. `npm run build` — builds without errors, no TDX credentials needed
3. `cat .gitignore | grep env.local` — .env.local is gitignored
4. `cat src/app/error.tsx | head -1` — first line is `'use client'`
5. `cat package.json | grep '"lint"'` — uses `eslint .` not `next lint`
6. `npm list @tanstack/react-query server-only zod` — all three installed
</verification>

<success_criteria>
- `npm run dev` starts without errors
- `npm run build` succeeds with empty TDX_CLIENT_ID and TDX_CLIENT_SECRET
- Vue 2 `src/` is in `_archive/src/`
- `docs/` is in `_archive/docs/` (or deleted if git mv fails)
- `.env.local` exists and is listed in `.gitignore`
- `@tanstack/react-query`, `server-only`, and `zod` are in `package.json` dependencies
- shadcn/ui Button component exists at `src/components/ui/button.tsx`
- `src/app/error.tsx` first line is `'use client'`
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md` using the summary template.
</output>
