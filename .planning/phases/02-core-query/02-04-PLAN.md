---
phase: 02-core-query
plan: "04"
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - src/app/page.tsx
autonomous: false
requirements: [QURY-01, QURY-02, QURY-04, UIUX-02, UIUX-03, UIUX-04]

must_haves:
  truths:
    - "Visiting http://localhost:3000 shows the query form (origin select, destination select, date picker, swap button, search button)"
    - "Submitting the form shows 5 skeleton cards while loading, then the train list"
    - "Each train row/card shows trainNo, departure time, arrival time, travel duration, 標準席 badge, 商務席 badge"
    - "Clicking the swap button exchanges origin and destination in the form"
    - "Clicking 去訂票 opens a new browser tab"
    - "The page works on mobile viewport (360px wide) and desktop viewport (1280px wide)"
    - "No console errors (no hydration mismatch, no TypeScript runtime errors)"
  artifacts:
    - path: "src/app/page.tsx"
      provides: "Main page — wires QueryForm + TrainList together with shared QueryParams state"
      contains: "QueryForm"
  key_links:
    - from: "src/app/page.tsx"
      to: "src/components/query-form.tsx"
      via: "renders <QueryForm onSubmit={setQueryParams} />"
      pattern: "QueryForm.*onSubmit"
    - from: "src/app/page.tsx"
      to: "src/components/train-list.tsx"
      via: "renders <TrainList params={queryParams} />"
      pattern: "TrainList.*params"
---

<objective>
Wire the complete Phase 2 UI together by replacing the placeholder `src/app/page.tsx` with a page that renders `QueryForm` and `TrainList`. The page holds `queryParams` state — set by the form on submit, passed to the list for query triggering. Then perform a human visual verification of the full end-to-end flow.

Purpose: This plan closes Phase 2 by integrating all components built in Plans 02-01 through 02-03 and confirming the complete user flow works as designed.

Output: Updated `src/app/page.tsx`. Human confirmation of the working UI.
</objective>

<execution_context>
@/Users/diamond.hung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/diamond.hung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/page.tsx
@src/components/query-form.tsx
@src/components/train-list.tsx
@.planning/phases/02-core-query/02-02-SUMMARY.md
@.planning/phases/02-core-query/02-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace page.tsx with integrated QueryForm + TrainList</name>
  <files>src/app/page.tsx</files>
  <action>
Replace the placeholder `src/app/page.tsx` with the final page component.

**Important:** `page.tsx` is a Next.js Server Component by default. `QueryForm` and `TrainList` are 'use client' components. The page itself does NOT need 'use client' — the client components handle their own interactivity. However, `queryParams` state must live in a client component. Use a small client wrapper (inline or separate file). The cleanest approach for this scale: make page.tsx itself a Server Component that renders a single `<QueryPage>` client component, OR simply add 'use client' to page.tsx since it needs to manage state.

For this project's scale, the simplest correct approach: make `page.tsx` a client component (add `'use client'` at top). Next.js supports this; the trade-off (no server-side RSC benefits for this page) is acceptable because the page is a form UI, not a static/data page.

```typescript
// src/app/page.tsx
'use client'

import { useState } from 'react'
import { QueryForm, QueryParams } from '@/components/query-form'
import { TrainList } from '@/components/train-list'

export default function Home() {
  const [queryParams, setQueryParams] = useState<QueryParams | null>(null)

  return (
    <main className="min-h-screen bg-background">
      <div className="mx-auto max-w-2xl px-4 py-8">
        {/* Page header */}
        <div className="mb-6">
          <h1 className="text-2xl font-bold tracking-tight">高鐵查詢</h1>
          <p className="text-muted-foreground text-sm mt-1">查詢班次時刻與座位狀態</p>
        </div>

        {/* Query form — sets queryParams on submit */}
        <div className="mb-6 rounded-lg border bg-card p-4 shadow-sm">
          <QueryForm onSubmit={setQueryParams} />
        </div>

        {/* Train list — fires query only when queryParams is non-null */}
        <TrainList params={queryParams} />
      </div>
    </main>
  )
}
```

Then run a build verification:

```bash
npm run build
```

If build succeeds, start the dev server for human verification:

```bash
npm run dev
```
  </action>
  <verify>
1. `npm run build` completes with 0 TypeScript errors (Next.js route warnings about dynamic rendering are acceptable)
2. `npm run dev` starts successfully on http://localhost:3000
3. `grep "QueryForm" src/app/page.tsx` — QueryForm imported and rendered
4. `grep "TrainList" src/app/page.tsx` — TrainList imported and rendered
5. `grep "queryParams" src/app/page.tsx` — state variable connecting the two components
  </verify>
  <done>
    - `src/app/page.tsx` renders `QueryForm` and `TrainList` connected via `queryParams` state
    - `npm run build` succeeds with 0 TypeScript errors
    - Dev server starts on localhost:3000
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of complete Phase 2 UI flow</name>
  <files>none</files>
  <action>Human verifies the complete Phase 2 UI. Dev server is already running from Task 1. See how-to-verify for the 9-step test protocol.</action>
  <verify>User confirms all 9 tests pass (see how-to-verify below).</verify>
  <done>User types "approved" — all 9 test scenarios confirmed working.</done>
  <what-built>
    Complete Phase 2 UI: query form with station selects, date picker, swap button, and a train results area showing all 4 states (idle hint, skeleton loading, error+retry, results with seat badges and booking links). Mobile card layout and desktop table layout. Mock data shows 8 trains with varied seat statuses.
  </what-built>
  <how-to-verify>
    Dev server must be running at http://localhost:3000 (started in Task 1).

    **Test 1 — Initial state:**
    1. Open http://localhost:3000
    2. Confirm: form is visible with "起站" and "訖站" selects, a date field showing today's date (Taiwan time), a circular-arrow swap button, and a "查詢" button
    3. Confirm: below the form is hint text ("選擇起訖站與日期，即可查詢時刻表") — no train list yet

    **Test 2 — Station selects:**
    4. Click the "起站" select — confirm a dropdown appears with 12 stations (南港 through 左營)
    5. Select "台北" as origin
    6. Select "左營" as destination
    7. Confirm: both selects show the selected values

    **Test 3 — Swap button:**
    8. Click the swap (⇄) button
    9. Confirm: origin is now "左營", destination is now "台北"
    10. Swap back to 台北 → 左營 for subsequent tests

    **Test 4 — Date picker:**
    11. Click the date button — confirm calendar opens
    12. Confirm: the calendar opens to today's Taiwan date (should match current Taiwan time)
    13. Close the calendar without changing the date

    **Test 5 — Query and results:**
    14. With 台北→左營 selected, click "查詢"
    15. Confirm: 5 skeleton cards appear briefly (loading state)
    16. After loading: confirm 8 train rows appear (mock data)
    17. Each train should show: 4-digit train number, departure time (HH:MM), arrival time (HH:MM), travel duration
    18. Each train should show TWO seat badge rows: "標準席" and "商務席"
    19. Confirm badge colors: green=充足, amber/yellow=有限, red=售完, gray dash=—
    20. Confirm "商務席" label text appears in amber/gold color (distinct from "標準席" gray)

    **Test 6 — Booking link:**
    21. Click "去訂票" on any train row/card
    22. Confirm: a new browser tab opens to the THSR website (https://www.thsrc.com.tw or related)

    **Test 7 — Mobile layout (resize browser to ~375px width):**
    23. Resize browser window to mobile width (~375px)
    24. Confirm: train results show as CARDS (not table)
    25. Confirm: query form shows [起站][⇄][訖站] on one row

    **Test 8 — Desktop layout (restore to full width, ~1280px):**
    26. Restore browser to desktop width
    27. Confirm: train results show as a TABLE with column headers (車次, 出發, 抵達, 行車時間, 標準席, 商務席, 訂票)

    **Test 9 — No console errors:**
    28. Open browser DevTools console
    29. Confirm: no red errors, no "Hydration failed" warnings, no React key warnings
  </how-to-verify>
  <resume-signal>Type "approved" if all 9 tests pass, or describe which tests failed and what was observed</resume-signal>
</task>

</tasks>

<verification>
- `npm run build` passes with 0 TypeScript errors
- All 9 human verification tests pass (see checkpoint task)
- Phase 2 success criteria met:
  1. Form submits → train list shows (QURY-01)
  2. Each train shows 標準席 + 商務席 seat badges (QURY-02)
  3. 去訂票 link opens THSR booking site in new tab (QURY-04)
  4. Swap button works, date defaults to Taiwan timezone (UIUX-03, UIUX-04)
  5. Mobile card + desktop table layout works (UIUX-02)
</verification>

<success_criteria>
- `src/app/page.tsx` wires QueryForm and TrainList with shared queryParams state
- Human verification confirms all 9 test scenarios pass
- No TypeScript build errors
- No browser console errors or hydration warnings
- Phase 2 requirements QURY-01, QURY-02, QURY-04, UIUX-02, UIUX-03, UIUX-04 all demonstrably met
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-query/02-04-SUMMARY.md`
</output>
